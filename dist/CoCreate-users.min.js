!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.users=t())}(this,(function(){return(()=>{"use strict";var e={};return(()=>{var t=e;t.default=void 0;var o="users",r="",n="";_(),a(),c(),l(),y(),C();var i=!1;function a(){CoCreate.socket.listen("fetchedUser",(function(e){s(e)})),CoCreate.socket.listen("login",(function(e){f(e)})),CoCreate.socket.listen("createDocument",(function(e){m(e)})),CoCreate.socket.listen("usersCurrentOrg",(function(e){i=!0,!0,localStorage.setItem("apiKey",e.apiKey),localStorage.setItem("securityKey",e.securityKey),localStorage.setItem("organization_id",e.current_org),localStorage.setItem("adminUI_id",e.adminUI_id),localStorage.setItem("builderUI_id",e.builderUI_id),document.dispatchEvent(new CustomEvent("fetchedUsersCurrentOrg")),e.href&&(window.location.href=e.href)})),CoCreate.crud.listenMessage("changedUserStatus",(function(e){h(e)}))}function c(){var e=localStorage.getItem("user_id");if(e){var t={apiKey:config.apiKey,securityKey:config.securityKey,organization_id:config.organization_Id,"data-collection":o,user_id:e};CoCreate.socket.send("fetchUser",t)}}function s(e){u(e)}function u(e){for(var t=document.querySelectorAll(".checkPermission"),o=0;o<t.length;o++){var r=t[o],n=r.getAttribute("data-document_id")?r.getAttribute("data-document_id"):r.getAttribute("data-pass_document_id"),i=r.getAttribute("data-permission");if(-1==e["permission-"+n].indexOf(i))switch(i){case"create":case"read":case"delete":r.style.display="none";break;case"delete":r.readOnly=!0}else i}}function l(){for(var e=document.querySelectorAll("form"),t=0;t<e.length;t++)d(e[t])}function d(e){var t=e.querySelector(".loginBtn");t&&t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation();let o=e.getAttribute("data-collection")||"module_activity",r={};e.querySelectorAll("input, textarea").forEach((e=>{const t=e.getAttribute("name");let n=e.value;"password"==e.type&&(n=btoa(n)),o=e.getAttribute("data-collection")||o,t&&(r[t]=n)}));var n={apiKey:config.apiKey,securityKey:config.securityKey,organization_id:config.organization_Id,"data-collection":o,loginData:r};CoCreate.socket.send("login",n)}))}function f(e){const{success:t,status:o,message:r}=e;if(CoCreate.render.data({selector:"[data-template_id='afterLoginResponse']",render:e}),e.success){localStorage.setItem("user_id",e.id);let t="",o=document.querySelector("form .loginBtn a");o&&(t=o.getAttribute("href")),g(e.id,e.collection,t)}}function g(e,t,r){var n={"data-collection":t||o,user_id:e,href:r};CoCreate.socket.send("usersCurrentOrg",n)}function m(e){"organizations"===e.collection&&(n=e.document_id),e.collection===o&&(r=e.document_id),n&&r&&(CoCreate.crud.updateDocument({broadcast:!1,collection:o,document_id:r,data:{current_org:n,connected_orgs:[n]},broadcast:!1}),localStorage.setItem("user_id",r),g(r,o,null))}function y(){var e=localStorage.getItem("user_id");if(!e)return;let t=document.querySelectorAll(".org-changer");for(let n=0;n<t.length;n++){let a=t[n];var o=a.getAttribute("data-collection")?a.getAttribute("data-collection"):"module_activity",r=a.getAttribute("data-document_id");"users"==o&&r==e&&a.addEventListener("selectedValue",(function(t){setTimeout((function(){g(e);var t=setInterval((function(){i&&(location.reload(),clearInterval(t))}),100)}),300)}))}}function C(){let e=document.querySelectorAll(".logoutBtn");for(let t=0;t<e.length;t++){e[t].addEventListener("click",(function(e){e.preventDefault(),localStorage.clear();let t=this.getAttribute("href");t&&(document.location.href=t)}))}}function _(){var e;if(localStorage.getItem("user_id")){if(e=document.querySelector(".sessionTrue")){let t=e.getAttribute("href");t&&(document.location.href=t)}}else if(e=document.querySelector(".sessionFalse")){let t=e.getAttribute("href");t&&(localStorage.clear(),document.location.href=t)}}function h(e){if(!e.user_id)return;document.querySelectorAll(`[data-user_status][data-document_id='${e.user_id}']`).forEach((t=>{t.setAttribute("data-user_status",e.status)}))}var v={initSocketsForUsers:a,fetchUser:c,fetchedUser:s,checkPermissions:u,initLoginForms:l,initLoginForm:d,loginResult:f,getCurrentOrg:g,userRegisterAction:function(e){if(e){var t=e.closest("form");t&&CoCreate.form.request({form:t})}},registerResult:m,initCurrentOrgEles:y,initLogoutBtn:C,checkSession:_,changedUserStatus:h};t.default=v})(),e=e.default})()}));